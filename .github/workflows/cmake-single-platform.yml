# Enhanced CMake workflow for Windows 11 (and cross-platform).
# Based on GitHub starter: https://github.com/actions/starter-workflows/blob/main/ci/cmake-multi-platform.yml
# Adaptations: Matrix for Windows/Ubuntu; VS generator for Win; Ninja optional.

name: CMake Cross-Platform Build

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

env:
  BUILD_TYPE: Release  # Or Debug for debugging.

jobs:
  build:
    # Matrix for cross-platform: Add macos-latest if needed.
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false  # Keep running other OS if one fails.
      matrix:
        os: [ubuntu-latest, windows-latest]  # windows-latest â‰ˆ Win11 compatibility.
        include:
          - os: windows-latest
            generator: "Visual Studio 17 2022"  # VS 2022 for Win11.
            arch: "x64"
            build_tool: "ninja"  # Optional: Faster than MSBuild; skip if not needed.
          - os: ubuntu-latest
            generator: "Ninja"  # Default for Linux.
            build_tool: "ninja"

    steps:
    - uses: actions/checkout@v4  # v4 is latest as of 2025.

    # Optional: Setup Ninja/CMake for consistency (esp. on Windows).
    - name: Setup Ninja and CMake
      uses: lukka/get-cmake@latest  # From search results ; caches for speed.
      with:
        cmakeVersion: '3.28.0'  # Latest stable; adjust as needed.
        ninjaVersion: '1.11.1'

    - name: Configure CMake
      # Configure in 'build' dir. Use generator for platform-specific.
      run: |
        cmake -B build
          -G "${{ matrix.generator }}"
          -A "${{ matrix.arch }}"
          -DCMAKE_BUILD_TYPE=${{ env.BUILD_TYPE }}
          -DCMAKE_TOOLCHAIN_FILE=${{ github.workspace }}/conanfile.txt  # Optional: If using Conan for deps.

    - name: Build
      # Build with config (needed for VS multi-config).
      run: cmake --build build --config ${{ env.BUILD_TYPE }}

    - name: Test
      working-directory: ${{ github.workspace }}/build
      # Run tests; adjust if no tests.
      run: ctest -C ${{ env.BUILD_TYPE }} -V  # -V for verbose output.

    # Optional: Upload artifacts (e.g., binaries) on failure/success.
    - name: Upload Build Artifacts
      if: always()  # Upload even on failure.
      uses: actions/upload-artifact@v4
      with:
        name: build-${{ matrix.os }}-${{ env.BUILD_TYPE }}
        path: build/

    # Optional: Notify on failure (e.g., Slack/Email via actions).

